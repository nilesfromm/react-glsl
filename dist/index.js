"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; } function _nullishCoalesce(lhs, rhsFn) { if (lhs != null) { return lhs; } else { return rhsFn(); } } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var _react = require('react'); var _react2 = _interopRequireDefault(_react);var G={alpha:!0,antialias:!1,depth:!0,desynchronized:!0,failIfMajorPerformanceCaveat:void 0,powerPreference:"default",premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!1},N= exports.ShaderCanvas =({glsl:p,uniforms:L=[],className:E="",enableMouse:R=!0,enableTime:x=!0,pixelRatio:I=1,style:w={},webglAttributes:y=G})=>{let[s,T]=_react.useState.call(void 0, {x:.5,y:.5}),u=p,f=`#version 300 es
    in vec4 a_position;
    void main() {
      gl_Position = a_position;
    }
  `,[e,P]=_react.useState.call(void 0, ),t=_react.useRef.call(void 0, ),l=_react.useRef.call(void 0, null);_react.useEffect.call(void 0, ()=>{let r=l.current;if(r){P(_optionalChain([r, 'access', _2 => _2.getContext, 'optionalCall', _3 => _3("webgl2",{...y})]));let o=r.clientWidth|0,n=r.clientHeight|0;(r.width!==o||r.height!==n)&&(r.width=o,r.height=n)}},[l]);let m=_react.useCallback.call(void 0, (r,o)=>{if(!e)return;if(o!==e.VERTEX_SHADER&&o!==e.FRAGMENT_SHADER)throw new Error("Shader Type error");let n=e.createShader(o);if(!n)throw new Error("Shader Generation error");return e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)||console.error("Shader Compile error: "+e.getShaderInfoLog(n)),n},[e]),d=_react.useCallback.call(void 0, ({vertex:r,fragment:o})=>{if(!e)return;if(t.current=e.createProgram(),!t.current)throw new Error("Unable to create program.");let n=m(r,e.VERTEX_SHADER),a=m(o,e.FRAGMENT_SHADER);if(e.attachShader(t.current,n),e.attachShader(t.current,a),e.linkProgram(t.current),!e.getProgramParameter(t.current,e.LINK_STATUS))throw e.detachShader(t.current,n),e.detachShader(t.current,a),e.deleteShader(n),e.deleteShader(a),new Error(`Unable to initialize the shader program:
`+e.getProgramInfoLog(t.current));let i=e.createVertexArray();e.bindVertexArray(i);let C=e.getUniformLocation(t.current,"resolution"),_=e.getUniformLocation(t.current,"mouse"),h=e.getAttribLocation(t.current,"a_position");if(h>=0){var v=e.createVertexArray();e.bindVertexArray(v);let M=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,M),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(h),e.vertexAttribPointer(h,2,e.FLOAT,!1,0,0),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.useProgram(t.current),e.uniform2f(C,e.canvas.width,e.canvas.height),e.uniform2f(_,s.x,s.y),e.bindVertexArray(v),e.drawArrays(e.TRIANGLES,0,6)}},[m,e,s]),g=r=>{if(!e||!t.current||!x)return;L.forEach(a=>{if(!t.current)return;let i=e.getUniformLocation(t.current,a.name);if(!i)throw new Error(`Unable to get uniform location for ${a.name}`);typeof a.value=="number"?e.uniform1f(i,a.value):a.value.length===2?e.uniform2fv(i,a.value):a.value.length===3?e.uniform3fv(i,a.value):a.value.length===4&&e.uniform4fv(i,a.value)}),r*=.001;let o=e.getUniformLocation(t.current,"mouse"),n=e.getUniformLocation(t.current,"time");e.uniform2f(o,s.x,s.y),e.uniform1f(n,r),e.drawArrays(e.TRIANGLES,0,6),requestAnimationFrame(g)};requestAnimationFrame(g);let B=_react.useCallback.call(void 0, r=>{if(e&&t.current)return _nullishCoalesce(e.getUniformLocation(t.current,r), () => (void 0))},[e,t]);_react.useEffect.call(void 0, ()=>{!e||!f||!u||d({vertex:f,fragment:u})},[e,f,u,d]);let U=_react.useCallback.call(void 0, r=>{let o=r.target;R&&T({x:r.nativeEvent.offsetX/o.offsetWidth,y:1-r.nativeEvent.offsetY/o.offsetHeight})},[s]);return _react2.default.createElement("canvas",{ref:l,onMouseMove:r=>U(r),className:E,style:{width:"100%",height:"100%",...w}})};exports.ShaderCanvas = N;
//# sourceMappingURL=index.js.map